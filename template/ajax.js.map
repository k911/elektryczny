{"version":3,"sources":["ajax.js"],"names":["$","phpbb","addAjaxCallback","res","readTitle","NO_UNREAD_POSTS","unreadTitle","UNREAD_POSTS","iconsArray","forum_unread","forum_unread_subforum","forum_unread_locked","find","each","$this","this","unreadClass","readClass","hasClass","removeClass","addClass","children","attr","length","ajaxCallbacks","mark_topics_read","call","U_MARK_FORUMS","closeDarkenWrapper","updateTopicLinks","unreadClassSelectors","global_unread","announce_unread","sticky_unread","topic_unread","iconsState","classMap","classNames","key","value","push","join","has","remove","U_MARK_TOPICS","success","markNotifications","unreadCount","Number","data","parent","$popup","link","toggleClass","$title","originalTitle","text","replace","postId","undefined","href","split","post","parents","css","posts1","nextAll","fadeOut","visible","zebra","first","html","MESSAGE_TEXT","not","prev","poll","panel","resultsVisible","is","mostVotes","updatePanelHeight","height","outerHeight","hide","can_vote","show","option","optionId","vote_counts","total_votes","altText","voted","user_votes","mostVoted","percent","Math","round","percentRel","trim","bar","barTimeLapse","newBarClass","floor","setTimeout","animate","width","percentText","NO_VOTES","delay","fadeIn","confirmationDelay","slideDown","resizePanel","time","panelHeight","innerHeight","minHeight","click","e","preventDefault","$poll","ajax","filter","fn","getFunctionByName","ajaxify","selector","refresh","callback","i","val","$memberlistSearch","slideToggle","alt_text","focus","$textarea","resizeTextArea","maxHeight","jQuery"],"mappings":"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","file":"ajax.js","sourcesContent":["/* global phpbb */\r\n\r\n(function($) {  // Avoid conflicts with other libraries\r\n\r\n'use strict';\r\n\r\n// This callback will mark all forum icons read\r\nphpbb.addAjaxCallback('mark_forums_read', function(res) {\r\n\tvar readTitle = res.NO_UNREAD_POSTS;\r\n\tvar unreadTitle = res.UNREAD_POSTS;\r\n\tvar iconsArray = {\r\n\t\tforum_unread: 'forum_read',\r\n\t\tforum_unread_subforum: 'forum_read_subforum',\r\n\t\tforum_unread_locked: 'forum_read_locked'\r\n\t};\r\n\r\n\t$('li.row').find('dl[class*=\"forum_unread\"]').each(function() {\r\n\t\tvar $this = $(this);\r\n\r\n\t\t$.each(iconsArray, function(unreadClass, readClass) {\r\n\t\t\tif ($this.hasClass(unreadClass)) {\r\n\t\t\t\t$this.removeClass(unreadClass).addClass(readClass);\r\n\t\t\t}\r\n\t\t});\r\n\t\t$this.children('dt[title=\"' + unreadTitle + '\"]').attr('title', readTitle);\r\n\t});\r\n\r\n\t// Mark subforums read\r\n\t$('a.subforum[class*=\"unread\"]').removeClass('unread').addClass('read');\r\n\r\n\t// Mark topics read if we are watching a category and showing active topics\r\n\tif ($('#active_topics').length) {\r\n\t\tphpbb.ajaxCallbacks.mark_topics_read.call(this, res, false);\r\n\t}\r\n\r\n\t// Update mark forums read links\r\n\t$('[data-ajax=\"mark_forums_read\"]').attr('href', res.U_MARK_FORUMS);\r\n\r\n\tphpbb.closeDarkenWrapper(3000);\r\n});\r\n\r\n/**\r\n* This callback will mark all topic icons read\r\n*\r\n* @param {bool} [update_topic_links=true] Whether \"Mark topics read\" links\r\n* \tshould be updated. Defaults to true.\r\n*/\r\nphpbb.addAjaxCallback('mark_topics_read', function(res, updateTopicLinks) {\r\n\tvar readTitle = res.NO_UNREAD_POSTS;\r\n\tvar unreadTitle = res.UNREAD_POSTS;\r\n\tvar iconsArray = {\r\n\t\tglobal_unread: 'global_read',\r\n\t\tannounce_unread: 'announce_read',\r\n\t\tsticky_unread: 'sticky_read',\r\n\t\ttopic_unread: 'topic_read'\r\n\t};\r\n\tvar iconsState = ['', '_hot', '_hot_mine', '_locked', '_locked_mine', '_mine'];\r\n\tvar unreadClassSelectors;\r\n\tvar classMap = {};\r\n\tvar classNames = [];\r\n\r\n\tif (typeof updateTopicLinks === 'undefined') {\r\n\t\tupdateTopicLinks = true;\r\n\t}\r\n\r\n\t$.each(iconsArray, function(unreadClass, readClass) {\r\n\t\t$.each(iconsState, function(key, value) {\r\n\t\t\t// Only topics can be hot\r\n\t\t\tif ((value === '_hot' || value === '_hot_mine') && unreadClass !== 'topic_unread') {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tclassMap[unreadClass + value] = readClass + value;\r\n\t\t\tclassNames.push(unreadClass + value);\r\n\t\t});\r\n\t});\r\n\r\n\tunreadClassSelectors = '.' + classNames.join(',.');\r\n\r\n\t$('li.row').find(unreadClassSelectors).each(function() {\r\n\t\tvar $this = $(this);\r\n\t\t$.each(classMap, function(unreadClass, readClass) {\r\n\t\t\tif ($this.hasClass(unreadClass)) {\r\n\t\t\t\t$this.removeClass(unreadClass).addClass(readClass);\r\n\t\t\t}\r\n\t\t});\r\n\t\t$this.children('dt[title=\"' + unreadTitle + '\"]').attr('title', readTitle);\r\n\t});\r\n\r\n\t// Remove link to first unread post\r\n\t$('a').has('span.icon_topic_newest').remove();\r\n\r\n\t// Update mark topics read links\r\n\tif (updateTopicLinks) {\r\n\t\t$('[data-ajax=\"mark_topics_read\"]').attr('href', res.U_MARK_TOPICS);\r\n\t}\r\n\r\n\tphpbb.closeDarkenWrapper(3000);\r\n});\r\n\r\n// This callback will mark all notifications read\r\nphpbb.addAjaxCallback('notification.mark_all_read', function(res) {\r\n\tif (typeof res.success !== 'undefined') {\r\n\t\tphpbb.markNotifications($('#notification_list li.notification-unseen'), 0);\r\n\t\tphpbb.closeDarkenWrapper(3000);\r\n\t}\r\n});\r\n\r\n// This callback will mark a notification read\r\nphpbb.addAjaxCallback('notification.mark_read', function(res) {\r\n\tif (typeof res.success !== 'undefined') {\r\n\t\tvar unreadCount = Number($('.notifications.tab').data('badge')) - 1;\r\n\t\tphpbb.markNotifications($(this).parent('li.notification-unseen'), unreadCount);\r\n\t}\r\n});\r\n\r\n/**\r\n * Mark notification popup rows as read.\r\n *\r\n * @param {jQuery} $popup jQuery object(s) to mark read.\r\n * @param {int} unreadCount The new unread notifications count.\r\n */\r\nphpbb.markNotifications = function($popup, unreadCount) {\r\n\t// Remove the unread status.\r\n\t$popup.removeClass('notification-unseen');\r\n\t$popup.find('a.mark_read').remove();\r\n\r\n\t// Update the notification link to the real URL.\r\n\t$popup.each(function() {\r\n\t\tvar link = $(this).find('a');\r\n\t\tlink.attr('href', link.attr('data-real-url'));\r\n\t});\r\n\r\n\t// Update the unread count.\r\n\t$('.notifications.tab').attr('data-badge', unreadCount).toggleClass('non-zero mdl-badge mdl-badge--small', unreadCount > 0);\r\n\t\r\n\t// Remove the Mark all read link if there are no unread notifications.\r\n\tif (!unreadCount) {\r\n\t\t$('.mark_all_read').remove();\r\n\t}\r\n\r\n\t// Update page title\r\n\tvar $title = $('title');\r\n\tvar originalTitle = $title.text().replace(/(\\((\\d+)\\))/, '');\r\n\t$title.text((unreadCount ? '(' + unreadCount + ')' : '') + originalTitle);\r\n};\r\n\r\n// This callback finds the post from the delete link, and removes it.\r\nphpbb.addAjaxCallback('post_delete', function() {\r\n\tvar $this = $(this),\r\n\t\tpostId;\r\n\r\n\tif ($this.attr('data-refresh') === undefined) {\r\n\t\tpostId = $this[0].href.split('&p=')[1];\r\n\t\tvar post = $this.parents('#p' + postId).css('pointer-events', 'none');\r\n\t\tif (post.hasClass('bg1') || post.hasClass('bg2')) {\r\n\t\t\tvar posts1 = post.nextAll('.bg1');\r\n\t\t\tpost.nextAll('.bg2').removeClass('bg2').addClass('bg1');\r\n\t\t\tposts1.removeClass('bg1').addClass('bg2');\r\n\t\t}\r\n\t\tpost.fadeOut(function() {\r\n\t\t\t$(this).remove();\r\n\t\t});\r\n\t}\r\n});\r\n\r\n// This callback removes the approve / disapprove div or link.\r\nphpbb.addAjaxCallback('post_visibility', function(res) {\r\n\tvar remove = (res.visible) ? $(this) : $(this).parents('.post');\r\n\t$(remove).css('pointer-events', 'none').fadeOut(function() {\r\n\t\t$(this).remove();\r\n\t});\r\n\r\n\tif (res.visible) {\r\n\t\t// Remove the \"Deleted by\" message from the post on restoring.\r\n\t\tremove.parents('.post').find('.post_deleted_msg').css('pointer-events', 'none').fadeOut(function() {\r\n\t\t\t$(this).remove();\r\n\t\t});\r\n\t}\r\n});\r\n\r\n// This removes the parent row of the link or form that fired the callback.\r\nphpbb.addAjaxCallback('row_delete', function() {\r\n\t$(this).parents('tr').remove();\r\n});\r\n\r\n// This handles friend / foe additions removals.\r\nphpbb.addAjaxCallback('zebra', function(res) {\r\n\tvar zebra;\r\n\r\n\tif (res.success) {\r\n\t\tzebra = $('.zebra');\r\n\t\tzebra.first().html(res.MESSAGE_TEXT);\r\n\t\tzebra.not(':first').html('&nbsp;').prev().html('&nbsp;');\r\n\t}\r\n});\r\n\r\n/**\r\n * This callback updates the poll results after voting.\r\n */\r\nphpbb.addAjaxCallback('vote_poll', function(res) {\r\n\tif (typeof res.success !== 'undefined') {\r\n\t\tvar poll = $('.topic_poll');\r\n\t\tvar panel = poll.find('.panel');\r\n\t\tvar resultsVisible = poll.find('dl:first-child .resultbar').is(':visible');\r\n\t\tvar mostVotes = 0;\r\n\r\n\t\t// Set min-height to prevent the page from jumping when the content changes\r\n\t\tvar updatePanelHeight = function (height) {\r\n\t\t\theight = (typeof height === 'undefined') ? panel.find('.inner').outerHeight() : height;\r\n\t\t\tpanel.css('min-height', height);\r\n\t\t};\r\n\t\tupdatePanelHeight();\r\n\r\n\t\t// Remove the View results link\r\n\t\tif (!resultsVisible) {\r\n\t\t\tpoll.find('.poll_view_results').hide(500);\r\n\t\t}\r\n\r\n\t\tif (!res.can_vote) {\r\n\t\t\tpoll.find('.polls, .poll_max_votes, .poll_vote, .poll_option_select').fadeOut(500, function () {\r\n\t\t\t\tpoll.find('.resultbar, .poll_option_percent, .poll_total_votes').show();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t// If the user can still vote, simply slide down the results\r\n\t\t\tpoll.find('.resultbar, .poll_option_percent, .poll_total_votes').show(500);\r\n\t\t}\r\n\r\n\t\t// Get the votes count of the highest poll option\r\n\t\tpoll.find('[data-poll-option-id]').each(function() {\r\n\t\t\tvar option = $(this);\r\n\t\t\tvar optionId = option.attr('data-poll-option-id');\r\n\t\t\tmostVotes = (res.vote_counts[optionId] >= mostVotes) ? res.vote_counts[optionId] : mostVotes;\r\n\t\t});\r\n\r\n\t\t// Update the total votes count\r\n\t\tpoll.find('.poll_total_vote_cnt').html(res.total_votes);\r\n\r\n\t\t// Update each option\r\n\t\tpoll.find('[data-poll-option-id]').each(function() {\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar optionId = $this.attr('data-poll-option-id');\r\n\t\t\tvar voted = (typeof res.user_votes[optionId] !== 'undefined');\r\n\t\t\tvar mostVoted = (res.vote_counts[optionId] === mostVotes);\r\n\t\t\tvar percent = (!res.total_votes) ? 0 : Math.round((res.vote_counts[optionId] / res.total_votes) * 100);\r\n\t\t\tvar percentRel = (mostVotes === 0) ? 0 : Math.round((res.vote_counts[optionId] / mostVotes) * 100);\r\n\t\t\tvar altText;\r\n\r\n\t\t\taltText = $this.attr('data-alt-text');\r\n\t\t\tif (voted) {\r\n\t\t\t\t$this.attr('title', $.trim(altText));\r\n\t\t\t} else {\r\n\t\t\t\t$this.attr('title', '');\r\n\t\t\t};\r\n\t\t\t$this.toggleClass('voted', voted);\r\n\t\t\t$this.toggleClass('most-votes', mostVoted);\r\n\r\n\t\t\t// Update the bars\r\n\t\t\tvar bar = $this.find('.resultbar div');\r\n\t\t\tvar barTimeLapse = (res.can_vote) ? 500 : 1500;\r\n\t\t\tvar newBarClass = (percent === 100) ? 'pollbar5' : 'pollbar' + (Math.floor(percent / 20) + 1);\r\n\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tbar.animate({ width: percentRel + '%' }, 500)\r\n\t\t\t\t\t.removeClass('pollbar1 pollbar2 pollbar3 pollbar4 pollbar5')\r\n\t\t\t\t\t.addClass(newBarClass)\r\n\t\t\t\t\t.html(res.vote_counts[optionId]);\r\n\r\n\t\t\t\tvar percentText = percent ? percent + '%' : res.NO_VOTES;\r\n\t\t\t\t$this.find('.poll_option_percent').html(percentText);\r\n\t\t\t}, barTimeLapse);\r\n\t\t});\r\n\r\n\t\tif (!res.can_vote) {\r\n\t\t\tpoll.find('.polls').delay(400).fadeIn(500);\r\n\t\t}\r\n\r\n\t\t// Display \"Your vote has been cast.\" message. Disappears after 5 seconds.\r\n\t\tvar confirmationDelay = (res.can_vote) ? 300 : 900;\r\n\t\tpoll.find('.vote-submitted').delay(confirmationDelay).slideDown(200, function() {\r\n\t\t\tif (resultsVisible) {\r\n\t\t\t\tupdatePanelHeight();\r\n\t\t\t}\r\n\r\n\t\t\t$(this).delay(5000).fadeOut(500, function() {\r\n\t\t\t\tresizePanel(300);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Remove the gap resulting from removing options\r\n\t\tsetTimeout(function() {\r\n\t\t\tresizePanel(500);\r\n\t\t}, 1500);\r\n\r\n\t\tvar resizePanel = function (time) {\r\n\t\t\tvar panelHeight = panel.height();\r\n\t\t\tvar innerHeight = panel.find('.inner').outerHeight();\r\n\r\n\t\t\tif (panelHeight !== innerHeight) {\r\n\t\t\t\tpanel.css({ minHeight: '', height: panelHeight })\r\n\t\t\t\t\t.animate({ height: innerHeight }, time, function () {\r\n\t\t\t\t\t\tpanel.css({ minHeight: innerHeight, height: '' });\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n});\r\n\r\n/**\r\n * Show poll results when clicking View results link.\r\n */\r\n$('.poll_view_results a').click(function(e) {\r\n\t// Do not follow the link\r\n\te.preventDefault();\r\n\r\n\tvar $poll = $(this).parents('.topic_poll');\r\n\r\n\t$poll.find('.resultbar, .poll_option_percent, .poll_total_votes').show(500);\r\n\t$poll.find('.poll_view_results').hide(500);\r\n});\r\n\r\n$('[data-ajax]').each(function() {\r\n\tvar $this = $(this);\r\n\tvar ajax = $this.attr('data-ajax');\r\n\tvar filter = $this.attr('data-filter');\r\n\r\n\tif (ajax !== 'false') {\r\n\t\tvar fn = (ajax !== 'true') ? ajax : null;\r\n\t\tfilter = (filter !== undefined) ? phpbb.getFunctionByName(filter) : null;\r\n\r\n\t\tphpbb.ajaxify({\r\n\t\t\tselector: this,\r\n\t\t\trefresh: $this.attr('data-refresh') !== undefined,\r\n\t\t\tfilter: filter,\r\n\t\t\tcallback: fn\r\n\t\t});\r\n\t}\r\n});\r\n\r\n\r\n/**\r\n * This simply appends #preview to the action of the\r\n * QR action when you click the Full Editor & Preview button\r\n */\r\n$('#qr_full_editor').click(function() {\r\n\t$('#qr_postform').attr('action', function(i, val) {\r\n\t\treturn val + '#preview';\r\n\t});\r\n});\r\n\r\n\r\n/**\r\n * Make the display post links to use JS\r\n */\r\n$('.display_post').click(function(e) {\r\n\t// Do not follow the link\r\n\te.preventDefault();\r\n\r\n\tvar postId = $(this).attr('data-post-id');\r\n\t$('#post_content' + postId).show();\r\n\t$('#profile' + postId).show();\r\n\t$('#post_hidden' + postId).hide();\r\n});\r\n\r\n/**\r\n* Toggle the member search panel in memberlist.php.\r\n*\r\n* If user returns to search page after viewing results the search panel is automatically displayed.\r\n* In any case the link will toggle the display status of the search panel and link text will be\r\n* appropriately changed based on the status of the search panel.\r\n*/\r\n$('#member_search').click(function () {\r\n\tvar $memberlistSearch = $('#memberlist_search');\r\n\r\n\t$memberlistSearch.slideToggle('fast');\r\n\tphpbb.ajaxCallbacks.alt_text.call(this);\r\n\r\n\t// Focus on the username textbox if it's available and displayed\r\n\tif ($memberlistSearch.is(':visible')) {\r\n\t\t$('#username').focus();\r\n\t}\r\n\treturn false;\r\n});\r\n\r\n/**\r\n* Automatically resize textarea\r\n*/\r\n$(function() {\r\n\tvar $textarea = $('textarea:not(#message-box textarea, .no-auto-resize)');\r\n\tphpbb.resizeTextArea($textarea, { minHeight: 75, maxHeight: 250 });\r\n\tphpbb.resizeTextArea($('textarea', '#message-box'));\r\n});\r\n\r\n\r\n})(jQuery); // Avoid conflicts with other libraries\r\n"]}